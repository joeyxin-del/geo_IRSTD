# CFS方法流程图

## 1. 整体流程图

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   原始检测结果   │───▶│   序列信息提取   │───▶│   候选轨迹搜索   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                       │
                                                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   最终检测结果   │◀───│   漏检补全      │◀───│   轨迹验证      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 2. 详细步骤图

### 2.1 候选轨迹搜索

```
连续帧搜索:
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  起始帧     │───▶│  环形搜索   │───▶│  最佳匹配   │
│  检测点     │    │  窗口       │    │  点选择     │
└─────────────┘    └─────────────┘    └─────────────┘
                          │
                          ▼
                   ┌─────────────┐
                   │  距离验证   │
                   │  (R_min~R_max)│
                   └─────────────┘

非连续帧搜索:
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  起始帧     │───▶│  间隔2帧    │───▶│  插值寻找   │
│  检测点     │    │  搜索       │    │  中间点     │
└─────────────┘    └─────────────┘    └─────────────┘
```

### 2.2 轨迹验证

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  候选轨迹   │───▶│  线性拟合   │───▶│  R² > 0.7   │
│             │    │  验证       │    │  MSE < 200  │
└─────────────┘    └─────────────┘    └─────────────┘
                          │
                          ▼
                   ┌─────────────┐    ┌─────────────┐
                   │  匀速性     │───▶│  速度变化   │
                   │  验证       │    │  < 25%      │
                   └─────────────┘    └─────────────┘
                          │
                          ▼
                   ┌─────────────┐    ┌─────────────┐
                   │  几何约束   │───▶│  长度合理   │
                   │  验证       │    │  性检查     │
                   └─────────────┘    └─────────────┘
```

### 2.3 漏检补全

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  有效轨迹   │───▶│  线性拟合   │───▶│  轨迹方程   │
│             │    │  获得参数   │    │   y = ax + b │
└─────────────┘    └─────────────┘    └─────────────┘
                          │
                          ▼
                   ┌─────────────┐    ┌─────────────┐
                   │  缺失帧     │───▶│  时间插值   │
                   │  识别       │    │  位置估计   │
                   └─────────────┘    └─────────────┘
                          │
                          ▼
                   ┌─────────────┐    ┌─────────────┐
                   │  合理性     │───▶│  补全检测   │
                   │  验证       │    │  点添加     │
                   └─────────────┘    └─────────────┘
```

## 3. 环形搜索窗口示意图

```
                    R_max
              ┌─────────────┐
              │             │
              │   环形搜索  │
              │   区域      │
              │             │
              └─────────────┘
                    R_min
                     │
                     ▼
                 当前检测点
```

## 4. 轨迹验证流程图

```
输入: 候选轨迹
    │
    ▼
┌─────────────┐
│ 轨迹长度≥2? │───否──▶ 返回False
└─────────────┘
    │ 是
    ▼
┌─────────────┐
│ 轨迹长度≥3? │───否──▶ 直接计算直线
└─────────────┘
    │ 是
    ▼
┌─────────────┐
│ 线性回归    │
│ 拟合        │
└─────────────┘
    │
    ▼
┌─────────────┐
│ 计算R²和MSE │
└─────────────┘
    │
    ▼
┌─────────────┐
│ R²>0.7 且   │───否──▶ 返回False
│ MSE<200?    │
└─────────────┘
    │ 是
    ▼
┌─────────────┐
│ 计算速度    │
│ 标准差      │
└─────────────┘
    │
    ▼
┌─────────────┐
│ 速度变化    │───否──▶ 返回False
│ <25%?       │
└─────────────┘
    │ 是
    ▼
┌─────────────┐
│ 几何约束    │───否──▶ 返回False
│ 验证        │
└─────────────┘
    │ 是
    ▼
返回True
```

## 5. 关键参数说明

### 5.1 搜索参数
- **R_min**: 最小间隔距离 (50.0)
- **R_max**: 最大间隔距离 (140.0)
- **N_points**: 每组最大点数 (3)
- **Max_frame_gap**: 最大帧间隔 (2)

### 5.2 验证参数
- **R²_threshold**: 线性拟合阈值 (0.7)
- **MSE_threshold**: 均方误差阈值 (200)
- **Speed_variation**: 速度变化阈值 (25%)

### 5.3 搜索窗口计算
```python
search_window_min = max(r_min, trajectory_mean_distance - 2 * trajectory_std_distance)
search_window_max = min(r_max, trajectory_mean_distance + 2 * trajectory_std_distance)
```

## 6. 算法复杂度分析

### 6.1 时间复杂度
- **序列信息提取**: O(n)
- **候选轨迹搜索**: O(n² × m²)
- **轨迹验证**: O(k × p²)
- **漏检补全**: O(v × f)

其中：
- n: 检测点总数
- m: 每帧平均检测点数
- k: 候选轨迹数
- p: 轨迹平均长度
- v: 有效轨迹数
- f: 缺失帧数

### 6.2 空间复杂度
- **序列数据存储**: O(n)
- **候选轨迹存储**: O(k × p)
- **验证结果存储**: O(v)

## 7. 优化策略

### 7.1 搜索优化
- 使用空间索引结构
- 并行化搜索过程
- 早期终止策略

### 7.2 验证优化
- 缓存拟合结果
- 批量验证处理
- 阈值自适应调整

### 7.3 补全优化
- 增量式补全
- 冲突检测优化
- 结果去重优化 